# ğŸ” Ø³Ø±ÙˆÛŒØ³ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ù…Ø±Ú©Ø²ÛŒ (Auth Service) - Avinoo.ir

ÛŒÚ© Ø³ÛŒØ³ØªÙ… Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ù…ÛŒÚ©Ø±ÙˆØ³Ø±ÙˆÛŒØ³ÛŒ Ú©Ø§Ù…Ù„ Ø¨Ø§ Django + DRF Ú©Ù‡ Ø§Ø² JWT Ø¨Ø§ RSA Ø¨Ø±Ø§ÛŒ Ø§Ù…Ù†ÛŒØª Ø¨Ø§Ù„Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.

## ğŸ“‹ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ú©Ù„ÛŒØ¯ÛŒ

### ğŸŒ Ù…Ø¹Ù…Ø§Ø±ÛŒ Ù…ÛŒÚ©Ø±ÙˆØ³Ø±ÙˆÛŒØ³
- **Ø³Ø±ÙˆÛŒØ³ Ù…Ø±Ú©Ø²ÛŒ**: `auth.avinoo.ir` - Ù…Ø¯ÛŒØ±ÛŒØª ØªÙ…Ø§Ù… Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØªâ€ŒÙ‡Ø§
- **Ú©Ù„Ø§ÛŒÙ†Øªâ€ŒÙ‡Ø§**: `app1.avinoo.ir`, `app2.avinoo.ir` - Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù†â€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù
- **Single Sign-On (SSO)**: ÙˆØ±ÙˆØ¯ ÛŒÚ©Ø¨Ø§Ø±Ù‡ Ø¯Ø± ØªÙ…Ø§Ù… Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù†â€ŒÙ‡Ø§
- **JWT Ø¨Ø§ RSA**: Ø§Ù…Ù†ÛŒØª Ø¨Ø§Ù„Ø§ Ø¨Ø§ Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ Ø¹Ù…ÙˆÙ…ÛŒ/Ø®ØµÙˆØµÛŒ

### ğŸ”‘ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª
- **Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ùˆ ÙˆØ±ÙˆØ¯** Ø¨Ø§ Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ú©Ø§Ù…Ù„
- **JWT Token** Ø¨Ø§ Ø§Ù†Ù‚Ø¶Ø§ÛŒ Ù‚Ø§Ø¨Ù„ ØªÙ†Ø¸ÛŒÙ…
- **Refresh Token** Ø¨Ø±Ø§ÛŒ Ø§Ù…Ù†ÛŒØª Ø¨ÛŒØ´ØªØ±
- **ØªØ£ÛŒÛŒØ¯ Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ† Ùˆ Ø§ÛŒÙ…ÛŒÙ„**
- **Ù‚ÙÙ„ Ú©Ø±Ø¯Ù† Ø­Ø³Ø§Ø¨** Ù¾Ø³ Ø§Ø² ØªÙ„Ø§Ø´â€ŒÙ‡Ø§ÛŒ Ù†Ø§Ù…ÙˆÙÙ‚
- **Rate Limiting** Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø­Ù…Ù„Ø§Øª

### ğŸ‘¥ Ù…Ø¯ÛŒØ±ÛŒØª Ù†Ù‚Ø´â€ŒÙ‡Ø§ Ùˆ Ù…Ø¬ÙˆØ²Ù‡Ø§
- **Ù†Ù‚Ø´â€ŒÙ‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ…ÛŒ Ùˆ Ø³ÙØ§Ø±Ø´ÛŒ**
- **Ø§Ø®ØªØµØ§Øµ Ù†Ù‚Ø´ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†**
- **Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø¬ÙˆØ²Ù‡Ø§ÛŒ Ù†Ù‚Ø´â€ŒÙ‡Ø§**
- **Ù…Ø¬ÙˆØ²Ù‡Ø§ÛŒ Ù…Ø³ØªÙ‚ÛŒÙ… Ú©Ø§Ø±Ø¨Ø±Ø§Ù†**
- **Ù„Ø§Ú¯ Ø­Ø³Ø§Ø¨Ø±Ø³ÛŒ Ú©Ø§Ù…Ù„**

### ğŸ›¡ï¸ Ø§Ù…Ù†ÛŒØª
- **JWT Authentication** Ø¨Ø§ SimpleJWT
- **RSA Key Pair** Ø¨Ø±Ø§ÛŒ Ø§Ù…Ø¶Ø§ÛŒ ØªÙˆÚ©Ù†â€ŒÙ‡Ø§
- **CORS Configuration** Ø¨Ø±Ø§ÛŒ Ù…ÛŒÚ©Ø±ÙˆØ³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§
- **Rate Limiting** Ùˆ IP Tracking
- **Audit Logging** Ú©Ø§Ù…Ù„
- **Password Validation** Ù¾ÛŒØ´Ø±ÙØªÙ‡

## ğŸ—ï¸ Ù…Ø¹Ù…Ø§Ø±ÛŒ Ø³ÛŒØ³ØªÙ…

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   app1.avinoo.ir â”‚    â”‚   app2.avinoo.ir â”‚    â”‚  admin.avinoo.ir â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚  Client App 1   â”‚    â”‚  Client App 2   â”‚    â”‚  Admin Panel    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                      â”‚                      â”‚
          â”‚                      â”‚                      â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                           â”‚
                    â”‚    auth.avinoo.ir         â”‚
                    â”‚                           â”‚
                    â”‚   Auth Service (Django)   â”‚
                    â”‚                           â”‚
                    â”‚  â€¢ User Management        â”‚
                    â”‚  â€¢ JWT Token Generation   â”‚
                    â”‚  â€¢ SSO Authentication     â”‚
                    â”‚  â€¢ Role & Permission      â”‚
                    â”‚  â€¢ Audit Logging          â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ Ù†ØµØ¨ Ùˆ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ

### Ù¾ÛŒØ´â€ŒÙ†ÛŒØ§Ø²Ù‡Ø§
- Python 3.9+
- pip
- Git

### Ø±ÙˆØ´ 1: Ù†ØµØ¨ Ø®ÙˆØ¯Ú©Ø§Ø± (ØªÙˆØµÛŒÙ‡ Ø´Ø¯Ù‡)

```bash
# Ú©Ù„ÙˆÙ† Ú©Ø±Ø¯Ù† Ù¾Ø±ÙˆÚ˜Ù‡
git clone <repository-url>
cd auth_service

# Ø§Ø¬Ø±Ø§ÛŒ Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ù†ØµØ¨ Ø®ÙˆØ¯Ú©Ø§Ø±
./setup.sh
```

### Ø±ÙˆØ´ 2: Ù†ØµØ¨ Ø¯Ø³ØªÛŒ

```bash
# 1. Ø§ÛŒØ¬Ø§Ø¯ Ù…Ø­ÛŒØ· Ù…Ø¬Ø§Ø²ÛŒ
python -m venv venv

# 2. ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ù…Ø­ÛŒØ· Ù…Ø¬Ø§Ø²ÛŒ
# Windows:
venv\Scripts\activate
# Linux/Mac:
source venv/bin/activate

# 3. Ù†ØµØ¨ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§
pip install -r requirements.txt

# 4. Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù† ÙØ§ÛŒÙ„ Ù…Ø­ÛŒØ·
cp env.example .env

# 5. ÙˆÛŒØ±Ø§ÛŒØ´ ÙØ§ÛŒÙ„ .env Ø¨Ø§ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø®ÙˆØ¯

# 6. Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø§ÛŒØ±Ú©ØªÙˆØ±ÛŒâ€ŒÙ‡Ø§ÛŒ Ù„Ø§Ø²Ù…
mkdir -p logs media/avatars staticfiles keys

# 7. ØªÙˆÙ„ÛŒØ¯ Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ RSA
python scripts/generate_rsa_keys.py

# 8. Ø§Ø¬Ø±Ø§ÛŒ Ù…Ø§ÛŒÚ¯Ø±ÛŒØ´Ù†â€ŒÙ‡Ø§
python manage.py makemigrations
python manage.py migrate

# 9. Ø§ÛŒØ¬Ø§Ø¯ superuser
python scripts/create_superuser.py

# 10. Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù„Ø§ÛŒÙ†Øªâ€ŒÙ‡Ø§ÛŒ SSO
python scripts/create_sso_clients.py

# 11. Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø§Ø³ØªØ§ØªÛŒÚ©
python manage.py collectstatic --noinput

# 12. Ø§Ø¬Ø±Ø§ÛŒ Ø³Ø±ÙˆØ±
python manage.py runserver
```

## âš™ï¸ Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ

### ÙØ§ÛŒÙ„ .env

```env
# Django Settings
SECRET_KEY=your-secret-key-here
DEBUG=True
ALLOWED_HOSTS=localhost,127.0.0.1,auth.avinoo.ir

# Microservice Configuration
AUTH_SERVICE_DOMAIN=auth.avinoo.ir
ALLOWED_CLIENT_DOMAINS=app1.avinoo.ir,app2.avinoo.ir

# JWT Settings
JWT_ACCESS_TOKEN_LIFETIME=60
JWT_REFRESH_TOKEN_LIFETIME=7
JWT_PRIVATE_KEY_PATH=keys/private_key.pem
JWT_PUBLIC_KEY_PATH=keys/public_key.pem

# CORS Settings
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://127.0.0.1:3000,http://app1.avinoo.ir,http://app2.avinoo.ir

# Logging
LOG_LEVEL=INFO
```

## ğŸ“š API Endpoints

### ğŸ” Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª SSO

#### Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…
```bash
POST /api/register/
Content-Type: application/json

{
    "username": "testuser",
    "email": "test@example.com",
    "phone_number": "+989123456789",
    "password": "securepassword123",
    "password_confirm": "securepassword123",
    "first_name": "Test",
    "last_name": "User",
    "client_id": "app1_client",
    "redirect_uri": "https://app1.avinoo.ir/callback"
}
```

#### ÙˆØ±ÙˆØ¯
```bash
POST /api/login/
Content-Type: application/json

{
    "username": "testuser",
    "password": "securepassword123",
    "client_id": "app1_client",
    "redirect_uri": "https://app1.avinoo.ir/callback"
}
```

#### Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ØªÙˆÚ©Ù†
```bash
POST /api/validate-token/
Content-Type: application/json

{
    "token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9...",
    "client_id": "app1_client"
}
```

#### Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±
```bash
GET /api/user-info/
Authorization: Bearer <access_token>
```

#### Ø®Ø±ÙˆØ¬
```bash
POST /api/logout/
Authorization: Bearer <access_token>
Content-Type: application/json

{
    "client_id": "app1_client",
    "redirect_uri": "https://app1.avinoo.ir"
}
```

### ğŸŒ ØµÙØ­Ø§Øª ÙˆØ¨ SSO

#### ØµÙØ­Ù‡ ÙˆØ±ÙˆØ¯
```
GET /login/?client_id=app1_client&redirect_uri=https://app1.avinoo.ir/callback&state=random_state
```

#### ØµÙØ­Ù‡ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…
```
GET /register/?client_id=app1_client&redirect_uri=https://app1.avinoo.ir/callback&state=random_state
```

#### ØµÙØ­Ù‡ Ø¨Ø§Ø²Ú¯Ø´Øª
```
GET /callback/?token=JWT_TOKEN&state=random_state&client_id=app1_client
```

## ğŸ”„ Ø¬Ø±ÛŒØ§Ù† SSO

### 1. ÙˆØ±ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø± Ø¨Ù‡ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ú©Ù„Ø§ÛŒÙ†Øª
```
Ú©Ø§Ø±Ø¨Ø± â†’ app1.avinoo.ir â†’ Ø¨Ø±Ø±Ø³ÛŒ ØªÙˆÚ©Ù† â†’ Ø§Ú¯Ø± ØªÙˆÚ©Ù† Ù†Ø¯Ø§Ø´Øª â†’ Ø±ÛŒØ¯Ø§ÛŒØ±Ú©Øª Ø¨Ù‡ auth.avinoo.ir
```

### 2. Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ø¯Ø± Ø³Ø±ÙˆÛŒØ³ Ù…Ø±Ú©Ø²ÛŒ
```
auth.avinoo.ir/login?client_id=app1_client&redirect_uri=https://app1.avinoo.ir/callback
```

### 3. ÙˆØ±ÙˆØ¯ Ù…ÙˆÙÙ‚ Ùˆ ØªÙˆÙ„ÛŒØ¯ JWT
```
Ú©Ø§Ø±Ø¨Ø± ÙˆØ§Ø±Ø¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯ â†’ JWT ØªÙˆÙ„ÛŒØ¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯ â†’ Ø±ÛŒØ¯Ø§ÛŒØ±Ú©Øª Ø¨Ù‡ Ú©Ù„Ø§ÛŒÙ†Øª Ø¨Ø§ ØªÙˆÚ©Ù†
```

### 4. Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ú©Ù„Ø§ÛŒÙ†Øª
```
app1.avinoo.ir/callback?token=JWT_TOKEN â†’ Ø°Ø®ÛŒØ±Ù‡ ØªÙˆÚ©Ù† â†’ ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù†
```

## ğŸ§ª ØªØ³Øª Ø³ÛŒØ³ØªÙ…

### ØªØ³Øª API Ù‡Ø§
```bash
# Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ API
python scripts/test_sso_api.py
```

### ØªØ³Øª Ø±Ø§Ø¨Ø· Ú©Ø§Ø±Ø¨Ø±ÛŒ
1. **Auth Service**: http://127.0.0.1:8000
2. **App1**: http://127.0.0.1:8000/client_apps/app1/index.html
3. **App2**: http://127.0.0.1:8000/client_apps/app2/index.html

### ØªØ³Øª Ø¨Ø§ cURL

#### Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…
```bash
curl -X POST http://127.0.0.1:8000/api/register/ \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "email": "test@example.com",
    "password": "testpassword123",
    "password_confirm": "testpassword123",
    "first_name": "Test",
    "last_name": "User",
    "client_id": "app1_client",
    "redirect_uri": "https://app1.avinoo.ir/callback"
  }'
```

#### ÙˆØ±ÙˆØ¯
```bash
curl -X POST http://127.0.0.1:8000/api/login/ \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "password": "testpassword123",
    "client_id": "app1_client",
    "redirect_uri": "https://app1.avinoo.ir/callback"
  }'
```

#### Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ØªÙˆÚ©Ù†
```bash
curl -X POST http://127.0.0.1:8000/api/validate-token/ \
  -H "Content-Type: application/json" \
  -d '{
    "token": "YOUR_JWT_TOKEN",
    "client_id": "app1_client"
  }'
```

## ğŸ”§ ØªÙˆØ³Ø¹Ù‡

### Ø³Ø§Ø®ØªØ§Ø± Ù¾Ø±ÙˆÚ˜Ù‡
```
auth_service/
â”œâ”€â”€ apps/                    # Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù†â€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ø®Ù„ÛŒ
â”‚   â”œâ”€â”€ users/              # Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
â”‚   â”œâ”€â”€ roles/              # Ù…Ø¯ÛŒØ±ÛŒØª Ù†Ù‚Ø´â€ŒÙ‡Ø§
â”‚   â””â”€â”€ permissions/        # Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø¬ÙˆØ²Ù‡Ø§
â”œâ”€â”€ sso/                    # Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† SSO
â”‚   â”œâ”€â”€ models.py           # Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ SSO
â”‚   â”œâ”€â”€ views.py            # ÙˆÛŒÙˆÙ‡Ø§ÛŒ SSO
â”‚   â”œâ”€â”€ serializers.py      # Ø³Ø±ÛŒØ§Ù„Ø§ÛŒØ²Ø±Ù‡Ø§ÛŒ SSO
â”‚   â”œâ”€â”€ urls.py             # URL Ù‡Ø§ÛŒ SSO
â”‚   â””â”€â”€ utils.py            # ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ
â”œâ”€â”€ client_apps/            # Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù†â€ŒÙ‡Ø§ÛŒ Ú©Ù„Ø§ÛŒÙ†Øª Ù†Ù…ÙˆÙ†Ù‡
â”‚   â”œâ”€â”€ app1/               # Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ø§ÙˆÙ„
â”‚   â””â”€â”€ app2/               # Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ø¯ÙˆÙ…
â”œâ”€â”€ auth_service/           # ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ØµÙ„ÛŒ Ù¾Ø±ÙˆÚ˜Ù‡
â”œâ”€â”€ templates/              # Ù‚Ø§Ù„Ø¨â€ŒÙ‡Ø§ÛŒ HTML
â”œâ”€â”€ keys/                   # Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ RSA
â”œâ”€â”€ scripts/                # Ø§Ø³Ú©Ø±ÛŒÙ¾Øªâ€ŒÙ‡Ø§
â”œâ”€â”€ logs/                   # ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù„Ø§Ú¯
â”œâ”€â”€ media/                  # ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø±Ø³Ø§Ù†Ù‡
â”œâ”€â”€ staticfiles/            # ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø§Ø³ØªØ§ØªÛŒÚ©
â”œâ”€â”€ requirements.txt        # ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ
â”œâ”€â”€ env.example            # Ù†Ù…ÙˆÙ†Ù‡ ÙØ§ÛŒÙ„ Ù…Ø­ÛŒØ·
â””â”€â”€ README.md              # Ø§ÛŒÙ† ÙØ§ÛŒÙ„
```

### Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ú©Ù„Ø§ÛŒÙ†Øª Ø¬Ø¯ÛŒØ¯

#### 1. Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù„Ø§ÛŒÙ†Øª Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³
```python
from sso.models import SSOClient

client = SSOClient.objects.create(
    name='New App',
    domain='newapp.avinoo.ir',
    client_id='newapp_client',
    client_secret='your_secret_here',
    redirect_uri='https://newapp.avinoo.ir/callback',
    is_active=True
)
```

#### 2. Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª CORS
```env
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://127.0.0.1:3000,http://app1.avinoo.ir,http://app2.avinoo.ir,http://newapp.avinoo.ir
```

#### 3. Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø± Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ú©Ù„Ø§ÛŒÙ†Øª
```javascript
const APP_CONFIG = {
    name: 'New App',
    domain: 'newapp.avinoo.ir',
    clientId: 'newapp_client',
    authServiceUrl: 'https://auth.avinoo.ir',
    redirectUri: window.location.origin + '/callback'
};
```

## ğŸ“Š Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ Ùˆ Ù„Ø§Ú¯â€ŒÙ‡Ø§

### ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù„Ø§Ú¯
- `logs/django.log` - Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ Django
- Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ Ø­Ø³Ø§Ø¨Ø±Ø³ÛŒ SSO Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³

### Ø³Ø·Ø­â€ŒÙ‡Ø§ÛŒ Ù„Ø§Ú¯
- DEBUG: Ø¬Ø²Ø¦ÛŒØ§Øª Ú©Ø§Ù…Ù„
- INFO: Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¹Ù…ÙˆÙ…ÛŒ
- WARNING: Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§
- ERROR: Ø®Ø·Ø§Ù‡Ø§
- CRITICAL: Ø®Ø·Ø§Ù‡Ø§ÛŒ Ø¨Ø­Ø±Ø§Ù†ÛŒ

### Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ SSO
```bash
# Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ SSO
python manage.py shell
>>> from sso.models import SSOAuditLog
>>> logs = SSOAuditLog.objects.all()[:10]
>>> for log in logs:
...     print(f"{log.action}: {log.user} -> {log.client} at {log.created_at}")
```

## ğŸš€ Ø§Ø³ØªÙ‚Ø±Ø§Ø± Ø¯Ø± Production

### ØªÙ†Ø¸ÛŒÙ…Ø§Øª Production
```env
DEBUG=False
ALLOWED_HOSTS=auth.avinoo.ir,www.auth.avinoo.ir
SECRET_KEY=your-production-secret-key
AUTH_SERVICE_DOMAIN=auth.avinoo.ir
CORS_ALLOWED_ORIGINS=https://app1.avinoo.ir,https://app2.avinoo.ir
```

### Ø§Ø¬Ø±Ø§ Ø¨Ø§ Gunicorn
```bash
gunicorn auth_service.wsgi:application --bind 0.0.0.0:8000 --workers 4
```

### Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Nginx
```nginx
server {
    listen 80;
    server_name auth.avinoo.ir;
    
    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    
    location /static/ {
        alias /path/to/staticfiles/;
    }
    
    location /media/ {
        alias /path/to/media/;
    }
}
```

### SSL/HTTPS
```bash
# Ù†ØµØ¨ SSL Ø¨Ø§ Let's Encrypt
sudo apt install certbot python3-certbot-nginx
sudo certbot --nginx -d auth.avinoo.ir
```

## ğŸ”’ Ø§Ù…Ù†ÛŒØª

### Ø¨Ù‡ØªØ±ÛŒÙ† Ø±ÙˆØ´â€ŒÙ‡Ø§
- Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² HTTPS Ø¯Ø± Production
- ØªØºÛŒÛŒØ± SECRET_KEY Ùˆ Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ RSA
- Ù…Ø­Ø¯ÙˆØ¯ Ú©Ø±Ø¯Ù† ALLOWED_HOSTS
- Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ÙØ§ÛŒØ±ÙˆØ§Ù„ Ù…Ù†Ø§Ø³Ø¨
- Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ù…Ù†Ø¸Ù… Ø§Ø² Ø¯ÛŒØªØ§Ø¨ÛŒØ³
- Ù†Ø¸Ø§Ø±Øª Ø¨Ø± Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ Ø§Ù…Ù†ÛŒØªÛŒ

### Rate Limiting
- 5 Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¯Ø± Ø¯Ù‚ÛŒÙ‚Ù‡ Ø¨Ø±Ø§ÛŒ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…
- 10 Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¯Ø± Ø¯Ù‚ÛŒÙ‚Ù‡ Ø¨Ø±Ø§ÛŒ ÙˆØ±ÙˆØ¯
- 100 Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¯Ø± Ø³Ø§Ø¹Øª Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ù†Ø§Ø´Ù†Ø§Ø³
- 1000 Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¯Ø± Ø³Ø§Ø¹Øª Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ø´Ø¯Ù‡

### Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ RSA
```bash
# ØªÙˆÙ„ÛŒØ¯ Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯
python scripts/generate_rsa_keys.py

# Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù„ÛŒØ¯Ù‡Ø§
openssl rsa -in keys/private_key.pem -text -noout
openssl rsa -in keys/public_key.pem -pubin -text -noout
```

## ğŸ› Ø¹ÛŒØ¨â€ŒÛŒØ§Ø¨ÛŒ

### Ù…Ø´Ú©Ù„Ø§Øª Ø±Ø§ÛŒØ¬

#### 1. Ø®Ø·Ø§ÛŒ CORS
```
Access to fetch at 'http://127.0.0.1:8000/api/login/' from origin 'http://localhost:3000' has been blocked by CORS policy
```
**Ø±Ø§Ù‡ Ø­Ù„**: Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¯Ø§Ù…Ù†Ù‡ Ø¨Ù‡ `CORS_ALLOWED_ORIGINS`

#### 2. Ø®Ø·Ø§ÛŒ JWT
```
Token is invalid or expired
```
**Ø±Ø§Ù‡ Ø­Ù„**: Ø¨Ø±Ø±Ø³ÛŒ Ø§Ù†Ù‚Ø¶Ø§ÛŒ ØªÙˆÚ©Ù† Ùˆ Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ RSA

#### 3. Ø®Ø·Ø§ÛŒ Ú©Ù„Ø§ÛŒÙ†Øª
```
Client not found or inactive
```
**Ø±Ø§Ù‡ Ø­Ù„**: Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ Ùˆ ÙØ¹Ø§Ù„ Ø¨ÙˆØ¯Ù† Ú©Ù„Ø§ÛŒÙ†Øª Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³

### Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ Ù…ÙÛŒØ¯
```bash
# Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ Django
tail -f logs/django.log

# Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ SSO
python manage.py shell
>>> from sso.models import SSOAuditLog
>>> SSOAuditLog.objects.filter(action='error').order_by('-created_at')[:5]
```

## ğŸ“ Ù…Ø¬ÙˆØ²Ù‡Ø§

Ø§ÛŒÙ† Ù¾Ø±ÙˆÚ˜Ù‡ ØªØ­Øª Ù…Ø¬ÙˆØ² MIT Ù…Ù†ØªØ´Ø± Ø´Ø¯Ù‡ Ø§Ø³Øª.

## ğŸ¤ Ù…Ø´Ø§Ø±Ú©Øª

Ø¨Ø±Ø§ÛŒ Ù…Ø´Ø§Ø±Ú©Øª Ø¯Ø± Ù¾Ø±ÙˆÚ˜Ù‡:
1. Fork Ú©Ù†ÛŒØ¯
2. Branch Ø¬Ø¯ÛŒØ¯ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†ÛŒØ¯
3. ØªØºÛŒÛŒØ±Ø§Øª Ø®ÙˆØ¯ Ø±Ø§ commit Ú©Ù†ÛŒØ¯
4. Pull Request Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯

## ğŸ“ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ

Ø¨Ø±Ø§ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ùˆ Ø³ÙˆØ§Ù„Ø§Øª:
- Ø§ÛŒÙ…ÛŒÙ„: support@avinoo.ir
- GitHub Issues: [Ù„ÛŒÙ†Ú© Issues]

## ğŸ¯ Ù…Ø«Ø§Ù„ Ú©Ø§Ù…Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡

### 1. Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
```bash
# Ù†ØµØ¨ Ùˆ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ
git clone <repository-url>
cd auth_service
python -m venv venv
venv\Scripts\activate  # Windows
pip install -r requirements.txt
python scripts/generate_rsa_keys.py
python manage.py migrate
python scripts/create_superuser.py
python scripts/create_sso_clients.py
python manage.py runserver
```

### 2. ØªØ³Øª Ø³ÛŒØ³ØªÙ…
```bash
# ØªØ³Øª API
python scripts/test_sso_api.py

# Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù…Ø±ÙˆØ±Ú¯Ø±
# http://127.0.0.1:8000/client_apps/app1/index.html
```

### 3. Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯Ø± Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ú©Ù„Ø§ÛŒÙ†Øª
```javascript
// ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©Ù„Ø§ÛŒÙ†Øª
const APP_CONFIG = {
    name: 'My App',
    domain: 'myapp.avinoo.ir',
    clientId: 'myapp_client',
    authServiceUrl: 'https://auth.avinoo.ir',
    redirectUri: window.location.origin + '/callback'
};

// Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª
function checkAuth() {
    const token = localStorage.getItem('auth_token');
    if (token) {
        validateToken(token);
    } else {
        redirectToLogin();
    }
}

// Ø±ÛŒØ¯Ø§ÛŒØ±Ú©Øª Ø¨Ù‡ ØµÙØ­Ù‡ ÙˆØ±ÙˆØ¯
function redirectToLogin() {
    const loginUrl = `${APP_CONFIG.authServiceUrl}/login/?client_id=${APP_CONFIG.clientId}&redirect_uri=${encodeURIComponent(APP_CONFIG.redirectUri)}`;
    window.location.href = loginUrl;
}
```

---

**Ù†Ú©ØªÙ‡ Ù…Ù‡Ù…**: Ø§ÛŒÙ† Ø³Ø±ÙˆÛŒØ³ Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯Ø± Ù…Ø­ÛŒØ· Production Ø·Ø±Ø§Ø­ÛŒ Ø´Ø¯Ù‡ Ùˆ Ø´Ø§Ù…Ù„ ØªÙ…Ø§Ù… ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø§Ù…Ù†ÛŒØªÛŒ Ùˆ Ù…Ø¯ÛŒØ±ÛŒØªÛŒ Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø² Ø¨Ø±Ø§ÛŒ ÛŒÚ© Ø³ÛŒØ³ØªÙ… Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ù…ÛŒÚ©Ø±ÙˆØ³Ø±ÙˆÛŒØ³ÛŒ Ù…ÛŒâ€ŒØ¨Ø§Ø´Ø¯.

**Ø¢Ø®Ø±ÛŒÙ† Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ**: 2024
**Ù†Ø³Ø®Ù‡**: 1.0.0
**ØªÙˆØ³Ø¹Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ù‡**: ØªÛŒÙ… Avinoo.ir