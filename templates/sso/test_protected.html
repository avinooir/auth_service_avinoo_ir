{% extends "sso/base.html" %}
{% load static %}

{% block title %}ØµÙØ­Ù‡ ØªØ³ØªÛŒ Ù…Ø­Ø§ÙØ¸Øª Ø´Ø¯Ù‡ - Auth Service{% endblock %}

{% block extra_css %}
<style>
    .test-container {
        max-width: 800px;
        margin: 2rem auto;
        padding: 2rem;
        background: #fff;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    .success-badge {
        background: linear-gradient(135deg, #4CAF50, #45a049);
        color: white;
        padding: 1rem 2rem;
        border-radius: 8px;
        text-align: center;
        margin-bottom: 2rem;
        font-size: 1.2rem;
        font-weight: bold;
    }
    
    .user-info {
        background: #f8f9fa;
        padding: 1.5rem;
        border-radius: 8px;
        margin-bottom: 2rem;
        border-left: 4px solid #007bff;
    }
    
    .info-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.5rem 0;
        border-bottom: 1px solid #e9ecef;
    }
    
    .info-row:last-child {
        border-bottom: none;
    }
    
    .info-label {
        font-weight: bold;
        color: #495057;
    }
    
    .info-value {
        color: #6c757d;
    }
    
    .action-buttons {
        display: flex;
        gap: 1rem;
        justify-content: center;
        margin-top: 2rem;
    }
    
    .btn {
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 5px;
        text-decoration: none;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .btn-primary {
        background: #007bff;
        color: white;
    }
    
    .btn-primary:hover {
        background: #0056b3;
        transform: translateY(-2px);
    }
    
    .btn-danger {
        background: #dc3545;
        color: white;
    }
    
    .btn-danger:hover {
        background: #c82333;
        transform: translateY(-2px);
    }
    
    .btn-success {
        background: #28a745;
        color: white;
    }
    
    .btn-success:hover {
        background: #218838;
        transform: translateY(-2px);
    }
    
    .test-features {
        background: #e3f2fd;
        padding: 1.5rem;
        border-radius: 8px;
        margin-top: 2rem;
    }
    
    .test-features h3 {
        color: #1976d2;
        margin-bottom: 1rem;
    }
    
    .feature-list {
        list-style: none;
        padding: 0;
    }
    
    .feature-list li {
        padding: 0.5rem 0;
        border-bottom: 1px solid #bbdefb;
    }
    
    .feature-list li:last-child {
        border-bottom: none;
    }
    
    .feature-list li::before {
        content: "âœ… ";
        margin-right: 0.5rem;
    }
    
    .timestamp {
        font-size: 0.9rem;
        color: #6c757d;
        text-align: center;
        margin-top: 2rem;
        padding-top: 1rem;
        border-top: 1px solid #e9ecef;
    }
</style>
{% endblock %}

{% block content %}
<div class="test-container">
    <div class="success-badge">
        ğŸ‰ Ù…ÙˆÙÙ‚ÛŒØª! Ø´Ù…Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡â€ŒØ§ÛŒØ¯
    </div>
    
    <div class="user-info">
        <h2>Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±</h2>
        <div class="info-row">
            <span class="info-label">Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ:</span>
            <span class="info-value">{{ user.username }}</span>
        </div>
        <div class="info-row">
            <span class="info-label">Ù†Ø§Ù…:</span>
            <span class="info-value">{{ user.first_name }} {{ user.last_name }}</span>
        </div>
        <div class="info-row">
            <span class="info-label">Ø§ÛŒÙ…ÛŒÙ„:</span>
            <span class="info-value">{{ user.email }}</span>
        </div>
        <div class="info-row">
            <span class="info-label">Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ†:</span>
            <span class="info-value">{{ user.phone_number|default:"Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡" }}</span>
        </div>
        <div class="info-row">
            <span class="info-label">ÙˆØ¶Ø¹ÛŒØª:</span>
            <span class="info-value">
                {% if user.is_active %}
                    <span style="color: #28a745;">ÙØ¹Ø§Ù„</span>
                {% else %}
                    <span style="color: #dc3545;">ØºÛŒØ±ÙØ¹Ø§Ù„</span>
                {% endif %}
            </span>
        </div>
        <div class="info-row">
            <span class="info-label">Ø¢Ø®Ø±ÛŒÙ† ÙˆØ±ÙˆØ¯:</span>
            <span class="info-value">
                {% if login_time %}
                    {{ login_time|date:"Y/m/d H:i:s" }}
                {% else %}
                    Ø§ÙˆÙ„ÛŒÙ† ÙˆØ±ÙˆØ¯
                {% endif %}
            </span>
        </div>
        <div class="info-row">
            <span class="info-label">ØªØ§Ø±ÛŒØ® Ø¹Ø¶ÙˆÛŒØª:</span>
            <span class="info-value">{{ user.date_joined|date:"Y/m/d H:i:s" }}</span>
        </div>
    </div>
    
    <div class="test-features">
        <h3>ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ ØªØ³Øª Ø´Ø¯Ù‡:</h3>
        <ul class="feature-list">
            <li>Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ù…ÙˆÙÙ‚</li>
            <li>Ø§Ù†ØªÙ‚Ø§Ù„ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ù‡ ØµÙØ­Ù‡ ÙˆØ±ÙˆØ¯</li>
            <li>Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ Ù¾Ø³ Ø§Ø² ÙˆØ±ÙˆØ¯</li>
            <li>Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±</li>
            <li>Ù„Ø§Ú¯ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§</li>
            <li>Ù…Ø¯ÛŒØ±ÛŒØª session</li>
        </ul>
    </div>
    
    <div class="action-buttons">
        <a href="{% url 'sso:sso_user_info' %}" class="btn btn-primary">
            ğŸ“Š Ø§Ø·Ù„Ø§Ø¹Ø§Øª API
        </a>
        <a href="{% url 'admin:index' %}" class="btn btn-success">
            âš™ï¸ Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª
        </a>
        <a href="{% url 'sso:sso_logout' %}" class="btn btn-danger" onclick="return confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø®Ø§Ø±Ø¬ Ø´ÙˆÛŒØ¯ØŸ')">
            ğŸšª Ø®Ø±ÙˆØ¬
        </a>
    </div>
    
    <div class="timestamp">
        Ø²Ù…Ø§Ù† Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØµÙØ­Ù‡: {{ current_time|date:"Y/m/d H:i:s" }}
    </div>
</div>

<script>
// Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… Ù…ÙˆÙÙ‚ÛŒØª
document.addEventListener('DOMContentLoaded', function() {
    // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ ØªÙˆÚ©Ù† Ø¯Ø± URL (Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ² Ø¨ÙˆØ¯Ù† callback)
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('token')) {
        // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ² Ø¨ÙˆØ¯Ù† ÙˆØ±ÙˆØ¯
        console.log('âœ… ÙˆØ±ÙˆØ¯ Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ² Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯');
        
        // Ø­Ø°Ù ØªÙˆÚ©Ù† Ø§Ø² URL Ø¨Ø±Ø§ÛŒ Ø§Ù…Ù†ÛŒØª
        const newUrl = window.location.pathname;
        window.history.replaceState({}, document.title, newUrl);
    }
    
    // Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± Ø¯Ø± Ú©Ù†Ø³ÙˆÙ„
    console.log('ğŸ‘¤ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±:', {
        username: '{{ user.username }}',
        email: '{{ user.email }}',
        name: '{{ user.first_name }} {{ user.last_name }}',
        isActive: {{ user.is_active|yesno:"true,false" }}
    });
});

// ØªØ§Ø¨Ø¹ Ø®Ø±ÙˆØ¬
function logout() {
    if (confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø®Ø§Ø±Ø¬ Ø´ÙˆÛŒØ¯ØŸ')) {
        // Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ API Ø®Ø±ÙˆØ¬ Ø±Ø§ ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ú©Ù†ÛŒØ¯
        fetch('/api/logout/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + localStorage.getItem('auth_token')
            },
            body: JSON.stringify({
                'client_id': 'test_page_client'
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Ø­Ø°Ù ØªÙˆÚ©Ù† Ø§Ø² localStorage
                localStorage.removeItem('auth_token');
                // Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ
                window.location.href = '/';
            }
        })
        .catch(error => {
            console.error('Ø®Ø·Ø§ Ø¯Ø± Ø®Ø±ÙˆØ¬:', error);
            // Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§ØŒ Ø¨Ø§Ø² Ù‡Ù… Ø¨Ù‡ ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ Ø¨Ø±ÙˆÛŒØ¯
            window.location.href = '/';
        });
    }
}
</script>
{% endblock %}
