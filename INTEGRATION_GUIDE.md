# ğŸ”— Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§ØªØµØ§Ù„ Ø§Ù¾â€ŒÙ‡Ø§ÛŒ Ø¯ÛŒÚ¯Ø± Ø¨Ù‡ Ø³ÛŒØ³ØªÙ… Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª

## ğŸ“‹ Ø®Ù„Ø§ØµÙ‡ Ø³ÛŒØ³ØªÙ…

Ø§ÛŒÙ† Ø³ÛŒØ³ØªÙ… ÛŒÚ© **Ø³Ø±ÙˆÛŒØ³ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ù…Ø±Ú©Ø²ÛŒ** Ø§Ø³Øª Ú©Ù‡ Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² **JWT + RSA** Ùˆ **Single Sign-On (SSO)** Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯.

### ğŸ—ï¸ Ù…Ø¹Ù…Ø§Ø±ÛŒ Ú©Ù„ÛŒ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Ø§Ù¾ Ø´Ù…Ø§        â”‚    â”‚   Ø§Ù¾ Ø¯ÛŒÚ¯Ø±ÛŒ      â”‚    â”‚  Ù¾Ù†Ù„ Ø§Ø¯Ù…ÛŒÙ†      â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚  your-app.com   â”‚    â”‚  other-app.com  â”‚    â”‚  admin.com      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                      â”‚                      â”‚
          â”‚                      â”‚                      â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                           â”‚
                    â”‚    auth.avinoo.ir         â”‚
                    â”‚                           â”‚
                    â”‚   Ø³Ø±ÙˆÛŒØ³ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª        â”‚
                    â”‚                           â”‚
                    â”‚  â€¢ ÙˆØ±ÙˆØ¯/Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…           â”‚
                    â”‚  â€¢ ØªÙˆÙ„ÛŒØ¯ JWT Token        â”‚
                    â”‚  â€¢ Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ØªÙˆÚ©Ù†        â”‚
                    â”‚  â€¢ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ Ù…Ø±Ø§Ø­Ù„ Ø§ØªØµØ§Ù„ Ø§Ù¾ Ø´Ù…Ø§

### Ù…Ø±Ø­Ù„Ù‡ 1: Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ù„Ø§ÛŒÙ†Øª

Ø§Ø¨ØªØ¯Ø§ Ø¨Ø§ÛŒØ¯ ÛŒÚ© **Ú©Ù„Ø§ÛŒÙ†Øª** Ø¯Ø± Ø³ÛŒØ³ØªÙ… Ø«Ø¨Øª Ú©Ù†ÛŒØ¯:

```bash
# Ø§Ø¬Ø±Ø§ÛŒ Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù„Ø§ÛŒÙ†Øª
python scripts/create_sso_clients.py
```

ÛŒØ§ Ø§Ø² Ø·Ø±ÛŒÙ‚ Ù¾Ù†Ù„ Ø§Ø¯Ù…ÛŒÙ†:
1. Ø¨Ø±Ùˆ Ø¨Ù‡ `http://auth.avinoo.ir/admin/`
2. Ø¨Ø®Ø´ `SSO Clients` Ø±Ø§ Ø¨Ø§Ø² Ú©Ù†
3. `Add SSO Client` Ø±Ø§ Ú©Ù„ÛŒÚ© Ú©Ù†
4. Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø²ÛŒØ± Ø±Ø§ Ù¾Ø± Ú©Ù†:

```
Name: Ù†Ø§Ù… Ø§Ù¾ Ø´Ù…Ø§
Domain: your-app.com
Client ID: your_app_client
Client Secret: ÛŒÚ© Ø±Ù…Ø² Ù‚ÙˆÛŒ
Redirect URI: https://your-app.com/callback
Is Active: âœ…
```

### Ù…Ø±Ø­Ù„Ù‡ 2: ØªÙ†Ø¸ÛŒÙ… CORS

Ø¯Ø± ÙØ§ÛŒÙ„ `.env` Ø³Ø±ÙˆÛŒØ³ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØªØŒ Ø¯Ø§Ù…Ù†Ù‡ Ø§Ù¾ Ø®ÙˆØ¯ Ø±Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†:

```env
CORS_ALLOWED_ORIGINS=https://your-app.com,https://www.your-app.com
```

### Ù…Ø±Ø­Ù„Ù‡ 3: Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø± Ø§Ù¾ Ø´Ù…Ø§

#### 3.1 ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ÙˆÙ„ÛŒÙ‡

```javascript
// config.js
const AUTH_CONFIG = {
    // Ø¢Ø¯Ø±Ø³ Ø³Ø±ÙˆÛŒØ³ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª
    authServiceUrl: 'https://auth.avinoo.ir',
    
    // Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ù„Ø§ÛŒÙ†Øª Ø´Ù…Ø§
    clientId: 'your_app_client',
    
    // Ø¢Ø¯Ø±Ø³ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ø¹Ø¯ Ø§Ø² ÙˆØ±ÙˆØ¯
    redirectUri: window.location.origin + '/callback',
    
    // Ù†Ø§Ù… Ø§Ù¾ Ø´Ù…Ø§
    appName: 'Ù†Ø§Ù… Ø§Ù¾ Ø´Ù…Ø§'
};
```

#### 3.2 Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª

```javascript
// auth.js
class AuthService {
    constructor() {
        this.config = AUTH_CONFIG;
        this.token = localStorage.getItem('auth_token');
    }

    // Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ú©Ø§Ø±Ø¨Ø± ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ ÛŒØ§ Ù†Ù‡
    isAuthenticated() {
        return !!this.token;
    }

    // Ø±ÛŒØ¯Ø§ÛŒØ±Ú©Øª Ø¨Ù‡ ØµÙØ­Ù‡ ÙˆØ±ÙˆØ¯
    redirectToLogin() {
        const loginUrl = `${this.config.authServiceUrl}/login/?` +
            `client_id=${this.config.clientId}&` +
            `redirect_uri=${encodeURIComponent(this.config.redirectUri)}&` +
            `state=${this.generateState()}`;
        
        window.location.href = loginUrl;
    }

    // ØªÙˆÙ„ÛŒØ¯ state Ø¨Ø±Ø§ÛŒ Ø§Ù…Ù†ÛŒØª
    generateState() {
        return Math.random().toString(36).substring(2, 15);
    }

    // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ØªÙˆÚ©Ù†
    async validateToken() {
        if (!this.token) return false;

        try {
            const response = await fetch(`${this.config.authServiceUrl}/api/validate-token/`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    token: this.token,
                    client_id: this.config.clientId
                })
            });

            const data = await response.json();
            return data.valid;
        } catch (error) {
            console.error('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ØªÙˆÚ©Ù†:', error);
            return false;
        }
    }

    // Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±
    async getUserInfo() {
        if (!this.token) return null;

        try {
            const response = await fetch(`${this.config.authServiceUrl}/api/user-info/`, {
                headers: {
                    'Authorization': `Bearer ${this.token}`
                }
            });

            return await response.json();
        } catch (error) {
            console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±:', error);
            return null;
        }
    }

    // Ø®Ø±ÙˆØ¬ Ø§Ø² Ø³ÛŒØ³ØªÙ…
    async logout() {
        try {
            await fetch(`${this.config.authServiceUrl}/api/logout/`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${this.token}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    client_id: this.config.clientId,
                    redirect_uri: window.location.origin
                })
            });
        } catch (error) {
            console.error('Ø®Ø·Ø§ Ø¯Ø± Ø®Ø±ÙˆØ¬:', error);
        } finally {
            localStorage.removeItem('auth_token');
            this.token = null;
            window.location.href = '/';
        }
    }
}
```

#### 3.3 ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ Ø§Ù¾

```html
<!-- index.html -->
<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù¾ Ø´Ù…Ø§</title>
    <style>
        body { font-family: 'Tahoma', sans-serif; margin: 0; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .header { background: #007bff; color: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .user-info { background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .btn { background: #dc3545; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
        .btn:hover { background: #c82333; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ  Ø§Ù¾ Ø´Ù…Ø§</h1>
            <p>Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯ Ø¨Ù‡ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ù…Ø§</p>
        </div>

        <div id="user-info" class="user-info" style="display: none;">
            <h3>ğŸ‘¤ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±</h3>
            <div id="user-details"></div>
            <button class="btn" onclick="authService.logout()">ğŸšª Ø®Ø±ÙˆØ¬</button>
        </div>

        <div id="login-prompt" style="text-align: center; padding: 40px;">
            <h3>ğŸ” Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø§Ù¾ØŒ Ø§Ø¨ØªØ¯Ø§ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯</h3>
            <button class="btn" onclick="authService.redirectToLogin()" style="background: #28a745;">
                ğŸ”‘ ÙˆØ±ÙˆØ¯ / Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…
            </button>
        </div>
    </div>

    <script src="config.js"></script>
    <script src="auth.js"></script>
    <script>
        const authService = new AuthService();

        // Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ù‡Ù†Ú¯Ø§Ù… Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØµÙØ­Ù‡
        window.addEventListener('load', async () => {
            if (authService.isAuthenticated()) {
                const isValid = await authService.validateToken();
                if (isValid) {
                    showUserInfo();
                } else {
                    authService.redirectToLogin();
                }
            } else {
                showLoginPrompt();
            }
        });

        async function showUserInfo() {
            const userInfo = await authService.getUserInfo();
            if (userInfo) {
                document.getElementById('user-details').innerHTML = `
                    <p><strong>Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ:</strong> ${userInfo.username}</p>
                    <p><strong>Ø§ÛŒÙ…ÛŒÙ„:</strong> ${userInfo.email}</p>
                    <p><strong>Ù†Ø§Ù…:</strong> ${userInfo.first_name} ${userInfo.last_name}</p>
                    <p><strong>Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ†:</strong> ${userInfo.phone_number || 'Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡'}</p>
                `;
                document.getElementById('user-info').style.display = 'block';
                document.getElementById('login-prompt').style.display = 'none';
            }
        }

        function showLoginPrompt() {
            document.getElementById('user-info').style.display = 'none';
            document.getElementById('login-prompt').style.display = 'block';
        }
    </script>
</body>
</html>
```

#### 3.4 ØµÙØ­Ù‡ Ø¨Ø§Ø²Ú¯Ø´Øª (Callback)

```html
<!-- callback.html -->
<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¯Ø± Ø­Ø§Ù„ ÙˆØ±ÙˆØ¯...</title>
    <style>
        body { font-family: 'Tahoma', sans-serif; text-align: center; padding: 50px; }
        .loading { color: #007bff; }
        .error { color: #dc3545; }
        .success { color: #28a745; }
    </style>
</head>
<body>
    <div id="status" class="loading">
        <h2>â³ Ø¯Ø± Ø­Ø§Ù„ ÙˆØ±ÙˆØ¯...</h2>
        <p>Ù„Ø·ÙØ§Ù‹ ØµØ¨Ø± Ú©Ù†ÛŒØ¯...</p>
    </div>

    <script src="config.js"></script>
    <script>
        // Ø¯Ø±ÛŒØ§ÙØª Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ÛŒ URL
        const urlParams = new URLSearchParams(window.location.search);
        const token = urlParams.get('token');
        const state = urlParams.get('state');
        const error = urlParams.get('error');

        if (error) {
            // Ø®Ø·Ø§ Ø¯Ø± ÙˆØ±ÙˆØ¯
            document.getElementById('status').innerHTML = `
                <h2 class="error">âŒ Ø®Ø·Ø§ Ø¯Ø± ÙˆØ±ÙˆØ¯</h2>
                <p>${error}</p>
                <button onclick="window.location.href='/'">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ</button>
            `;
        } else if (token) {
            // Ø°Ø®ÛŒØ±Ù‡ ØªÙˆÚ©Ù† Ùˆ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ
            localStorage.setItem('auth_token', token);
            document.getElementById('status').innerHTML = `
                <h2 class="success">âœ… ÙˆØ±ÙˆØ¯ Ù…ÙˆÙÙ‚</h2>
                <p>Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ...</p>
            `;
            
            // Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ Ø¨Ø¹Ø¯ Ø§Ø² 2 Ø«Ø§Ù†ÛŒÙ‡
            setTimeout(() => {
                window.location.href = '/';
            }, 2000);
        } else {
            // Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ÛŒ Ù„Ø§Ø²Ù… Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª
            document.getElementById('status').innerHTML = `
                <h2 class="error">âŒ Ø®Ø·Ø§</h2>
                <p>Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ÛŒ Ù„Ø§Ø²Ù… Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª</p>
                <button onclick="window.location.href='/'">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ</button>
            `;
        }
    </script>
</body>
</html>
```

## ğŸ”§ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾ÛŒØ´Ø±ÙØªÙ‡

### Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯Ø± React

```jsx
// AuthContext.jsx
import React, { createContext, useContext, useState, useEffect } from 'react';

const AuthContext = createContext();

export const useAuth = () => {
    const context = useContext(AuthContext);
    if (!context) {
        throw new Error('useAuth must be used within AuthProvider');
    }
    return context;
};

export const AuthProvider = ({ children }) => {
    const [user, setUser] = useState(null);
    const [loading, setLoading] = useState(true);
    const [isAuthenticated, setIsAuthenticated] = useState(false);

    const AUTH_CONFIG = {
        authServiceUrl: 'https://auth.avinoo.ir',
        clientId: 'your_app_client',
        redirectUri: window.location.origin + '/callback'
    };

    useEffect(() => {
        checkAuth();
    }, []);

    const checkAuth = async () => {
        const token = localStorage.getItem('auth_token');
        if (token) {
            try {
                const response = await fetch(`${AUTH_CONFIG.authServiceUrl}/api/validate-token/`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        token,
                        client_id: AUTH_CONFIG.clientId
                    })
                });

                const data = await response.json();
                if (data.valid) {
                    const userInfo = await getUserInfo();
                    setUser(userInfo);
                    setIsAuthenticated(true);
                } else {
                    localStorage.removeItem('auth_token');
                }
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª:', error);
                localStorage.removeItem('auth_token');
            }
        }
        setLoading(false);
    };

    const getUserInfo = async () => {
        const token = localStorage.getItem('auth_token');
        const response = await fetch(`${AUTH_CONFIG.authServiceUrl}/api/user-info/`, {
            headers: { 'Authorization': `Bearer ${token}` }
        });
        return await response.json();
    };

    const login = () => {
        const loginUrl = `${AUTH_CONFIG.authServiceUrl}/login/?` +
            `client_id=${AUTH_CONFIG.clientId}&` +
            `redirect_uri=${encodeURIComponent(AUTH_CONFIG.redirectUri)}`;
        window.location.href = loginUrl;
    };

    const logout = async () => {
        const token = localStorage.getItem('auth_token');
        try {
            await fetch(`${AUTH_CONFIG.authServiceUrl}/api/logout/`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    client_id: AUTH_CONFIG.clientId,
                    redirect_uri: window.location.origin
                })
            });
        } catch (error) {
            console.error('Ø®Ø·Ø§ Ø¯Ø± Ø®Ø±ÙˆØ¬:', error);
        } finally {
            localStorage.removeItem('auth_token');
            setUser(null);
            setIsAuthenticated(false);
        }
    };

    const value = {
        user,
        isAuthenticated,
        loading,
        login,
        logout
    };

    return (
        <AuthContext.Provider value={value}>
            {children}
        </AuthContext.Provider>
    );
};
```

### Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯Ø± Vue.js

```vue
<!-- AuthMixin.vue -->
<template>
  <div>
    <div v-if="loading">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</div>
    <div v-else-if="!isAuthenticated">
      <h3>Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø§Ù¾ØŒ Ø§Ø¨ØªØ¯Ø§ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯</h3>
      <button @click="login">ÙˆØ±ÙˆØ¯ / Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…</button>
    </div>
    <div v-else>
      <h3>Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯ {{ user.first_name }}!</h3>
      <button @click="logout">Ø®Ø±ÙˆØ¬</button>
    </div>
  </div>
</template>

<script>
export default {
  data() {
    return {
      user: null,
      isAuthenticated: false,
      loading: true,
      AUTH_CONFIG: {
        authServiceUrl: 'https://auth.avinoo.ir',
        clientId: 'your_app_client',
        redirectUri: window.location.origin + '/callback'
      }
    };
  },
  async mounted() {
    await this.checkAuth();
  },
  methods: {
    async checkAuth() {
      const token = localStorage.getItem('auth_token');
      if (token) {
        try {
          const response = await fetch(`${this.AUTH_CONFIG.authServiceUrl}/api/validate-token/`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              token,
              client_id: this.AUTH_CONFIG.clientId
            })
          });

          const data = await response.json();
          if (data.valid) {
            await this.getUserInfo();
            this.isAuthenticated = true;
          } else {
            localStorage.removeItem('auth_token');
          }
        } catch (error) {
          console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª:', error);
          localStorage.removeItem('auth_token');
        }
      }
      this.loading = false;
    },

    async getUserInfo() {
      const token = localStorage.getItem('auth_token');
      const response = await fetch(`${this.AUTH_CONFIG.authServiceUrl}/api/user-info/`, {
        headers: { 'Authorization': `Bearer ${token}` }
      });
      this.user = await response.json();
    },

    login() {
      const loginUrl = `${this.AUTH_CONFIG.authServiceUrl}/login/?` +
        `client_id=${this.AUTH_CONFIG.clientId}&` +
        `redirect_uri=${encodeURIComponent(this.AUTH_CONFIG.redirectUri)}`;
      window.location.href = loginUrl;
    },

    async logout() {
      const token = localStorage.getItem('auth_token');
      try {
        await fetch(`${this.AUTH_CONFIG.authServiceUrl}/api/logout/`, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            client_id: this.AUTH_CONFIG.clientId,
            redirect_uri: window.location.origin
          })
        });
      } catch (error) {
        console.error('Ø®Ø·Ø§ Ø¯Ø± Ø®Ø±ÙˆØ¬:', error);
      } finally {
        localStorage.removeItem('auth_token');
        this.user = null;
        this.isAuthenticated = false;
      }
    }
  }
};
</script>
```

## ğŸ“¡ API Endpoints

### 1. ÙˆØ±ÙˆØ¯
```http
POST /api/login/
Content-Type: application/json

{
    "username": "Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ",
    "password": "Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±",
    "client_id": "your_app_client",
    "redirect_uri": "https://your-app.com/callback"
}
```

### 2. Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…
```http
POST /api/register/
Content-Type: application/json

{
    "username": "Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ",
    "email": "email@example.com",
    "phone_number": "+989123456789",
    "password": "Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±",
    "password_confirm": "ØªÚ©Ø±Ø§Ø± Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±",
    "first_name": "Ù†Ø§Ù…",
    "last_name": "Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ",
    "client_id": "your_app_client",
    "redirect_uri": "https://your-app.com/callback"
}
```

### 3. Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ØªÙˆÚ©Ù†
```http
POST /api/validate-token/
Content-Type: application/json

{
    "token": "JWT_TOKEN",
    "client_id": "your_app_client"
}
```

### 4. Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±
```http
GET /api/user-info/
Authorization: Bearer JWT_TOKEN
```

### 5. Ø®Ø±ÙˆØ¬
```http
POST /api/logout/
Authorization: Bearer JWT_TOKEN
Content-Type: application/json

{
    "client_id": "your_app_client",
    "redirect_uri": "https://your-app.com"
}
```

## ğŸ”’ Ø§Ù…Ù†ÛŒØª

### Ù†Ú©Ø§Øª Ù…Ù‡Ù… Ø§Ù…Ù†ÛŒØªÛŒ:

1. **Ù‡Ù…ÛŒØ´Ù‡ Ø§Ø² HTTPS Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯** Ø¯Ø± Production
2. **Client Secret Ø±Ø§ Ù…Ø­Ø±Ù…Ø§Ù†Ù‡ Ù†Ú¯Ù‡ Ø¯Ø§Ø±ÛŒØ¯**
3. **ØªÙˆÚ©Ù†â€ŒÙ‡Ø§ Ø±Ø§ Ø¯Ø± localStorage Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†ÛŒØ¯** (Ù†Ù‡ Ø¯Ø± cookie)
4. **State parameter Ø±Ø§ Ø¨Ø±Ø§ÛŒ CSRF protection Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯**
5. **ØªÙˆÚ©Ù†â€ŒÙ‡Ø§ Ø±Ø§ Ù…Ù†Ø¸Ù… Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ú©Ù†ÛŒØ¯**

### Ù…Ø«Ø§Ù„ Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ù…Ù†Ø¸Ù…:

```javascript
// Ù‡Ø± 5 Ø¯Ù‚ÛŒÙ‚Ù‡ ÛŒÚ©Ø¨Ø§Ø± ØªÙˆÚ©Ù† Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†
setInterval(async () => {
    if (authService.isAuthenticated()) {
        const isValid = await authService.validateToken();
        if (!isValid) {
            authService.logout();
        }
    }
}, 5 * 60 * 1000);
```

## ğŸ§ª ØªØ³Øª

### ØªØ³Øª Ø¨Ø§ cURL:

```bash
# ØªØ³Øª ÙˆØ±ÙˆØ¯
curl -X POST https://auth.avinoo.ir/api/login/ \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "password": "testpass123",
    "client_id": "your_app_client",
    "redirect_uri": "https://your-app.com/callback"
  }'

# ØªØ³Øª Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ
curl -X POST https://auth.avinoo.ir/api/validate-token/ \
  -H "Content-Type: application/json" \
  -d '{
    "token": "YOUR_JWT_TOKEN",
    "client_id": "your_app_client"
  }'
```

## ğŸ†˜ Ø¹ÛŒØ¨â€ŒÛŒØ§Ø¨ÛŒ

### Ù…Ø´Ú©Ù„Ø§Øª Ø±Ø§ÛŒØ¬:

#### 1. Ø®Ø·Ø§ÛŒ CORS
```
Access to fetch at 'https://auth.avinoo.ir/api/login/' from origin 'https://your-app.com' has been blocked by CORS policy
```
**Ø±Ø§Ù‡ Ø­Ù„**: Ø¯Ø§Ù…Ù†Ù‡ Ø§Ù¾ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù‡ `CORS_ALLOWED_ORIGINS` Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯

#### 2. Ø®Ø·Ø§ÛŒ Client Not Found
```
Client not found or inactive
```
**Ø±Ø§Ù‡ Ø­Ù„**: Ú©Ù„Ø§ÛŒÙ†Øª Ø®ÙˆØ¯ Ø±Ø§ Ø¯Ø± Ù¾Ù†Ù„ Ø§Ø¯Ù…ÛŒÙ† Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯

#### 3. Ø®Ø·Ø§ÛŒ Invalid Token
```
Token is invalid or expired
```
**Ø±Ø§Ù‡ Ø­Ù„**: ØªÙˆÚ©Ù† Ø±Ø§ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø¯Ø±ÛŒØ§ÙØª Ú©Ù†ÛŒØ¯

## ğŸ“ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ

Ø¨Ø±Ø§ÛŒ Ø³ÙˆØ§Ù„Ø§Øª Ùˆ Ù…Ø´Ú©Ù„Ø§Øª:
- Ø§ÛŒÙ…ÛŒÙ„: support@avinoo.ir
- Ù…Ø³ØªÙ†Ø¯Ø§Øª Ú©Ø§Ù…Ù„: [Ù„ÛŒÙ†Ú© Ù…Ø³ØªÙ†Ø¯Ø§Øª]

---

**Ù†Ú©ØªÙ‡**: Ø§ÛŒÙ† Ø±Ø§Ù‡Ù†Ù…Ø§ Ø¨Ø±Ø§ÛŒ Ø§ØªØµØ§Ù„ Ø³Ø±ÛŒØ¹ Ùˆ Ø¢Ø³Ø§Ù† Ø§Ù¾â€ŒÙ‡Ø§ÛŒ Ø´Ù…Ø§ Ø¨Ù‡ Ø³ÛŒØ³ØªÙ… Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ø·Ø±Ø§Ø­ÛŒ Ø´Ø¯Ù‡ Ø§Ø³Øª. Ø¨Ø±Ø§ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾ÛŒØ´Ø±ÙØªÙ‡â€ŒØªØ±ØŒ Ø¨Ù‡ Ù…Ø³ØªÙ†Ø¯Ø§Øª Ú©Ø§Ù…Ù„ Ù…Ø±Ø§Ø¬Ø¹Ù‡ Ú©Ù†ÛŒØ¯.
