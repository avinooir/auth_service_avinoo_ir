# ฺฏุฒุงุฑุด ุฌุงูุน - ุญู ูุดฺฉู ูุงฺฏุฑุดู GUID

**ุชุงุฑุฎ:** 13 ฺุงููู 2025  
**ุดูุงุฑู ฺฏุฒุงุฑุด:** 01  
**ููุถูุน:** ุญู ูุดฺฉู UNIQUE constraint failed ุฏุฑ ูุงฺฏุฑุดู GUID

## ๐ ุฎูุงุตู ูุดฺฉู

```
django.db.utils.IntegrityError: UNIQUE constraint failed: new__users.guid
```

ูุดฺฉู ุฏุฑ ูุงฺฏุฑุดู `0002_user_guid.py` ุจูุฏ ฺฉู ุณุน ูโฺฉุฑุฏ ููุฏ `guid` ุจุง constraint UNIQUE ุจู ุฌุฏูู `users` ุงุถุงูู ฺฉูุฏุ ุงูุง ฺฉุงุฑุจุฑุงู ููุฌูุฏ GUID ูุฏุงุดุชูุฏ.

## ๐ง ูุฑุงุญู ุญู ูุดฺฉู

### 1. ุญุฐู ูุงฺฏุฑุดู ูุดฺฉูโุฏุงุฑ
- **ูุงู ุญุฐู ุดุฏู:** `apps/users/migrations/0002_user_guid.py`
- **ุฏูู:** ูุงฺฏุฑุดู ุฏุงุฑุง ูุดฺฉู UNIQUE constraint ุจูุฏ

### 2. ุงุฌุงุฏ ูุงฺฏุฑุดู ุฌุฏุฏ
- **ูุงู ุงุฌุงุฏ ุดุฏู:** `apps/users/migrations/0002_user_guid.py`
- **ูฺฺฏโูุง:**
  - ุงุถุงูู ฺฉุฑุฏู ููุฏ GUID ุจุฏูู constraint
  - ุชููุฏ GUID ุจุฑุง ฺฉุงุฑุจุฑุงู ููุฌูุฏ
  - ุงุนูุงู unique constraint ุฏุฑ ูุฑุญูู ุขุฎุฑ

### 3. ุงุฌุฑุง ูุงฺฏุฑุดู
- **ุฑูุด:** ุงุณุชูุงุฏู ุงุฒ ุงุณฺฉุฑูพุช ุณูุงุฑุด ุจุฑุง ุญู ูุดฺฉู
- **ูุชุฌู:** ุชูุงู ฺฉุงุฑุจุฑุงู GUID ุฏุฑุงูุช ฺฉุฑุฏูุฏ

### 4. ุชุณุช ู ุจุฑุฑุณ
- **ุชุณุช GUID ฺฉุงุฑุจุฑุงู:** โ ูููู
- **ุชุณุช JWT Token:** โ ูููู
- **ุชุณุช API Response:** โ ูููู

## ๐ ูุชุงุฌ ููุง

### ูุถุนุช ฺฉุงุฑุจุฑุงู
- **ุชุนุฏุงุฏ ฺฉู ฺฉุงุฑุจุฑุงู:** 3
- **ฺฉุงุฑุจุฑุงู ุจุง GUID:** 3 (100%)
- **ฺฉุงุฑุจุฑุงู ุจุฏูู GUID:** 0

### ููููู GUID ูุง
```
admin: 6f99b0b3-33e7-49da-8ce9-7b1b7450c2bb
testuser: 9c8a09db-4458-4b2a-8c6a-535a787811de
mohammad: e6ee6a9a-54b5-445b-b8b1-46b33e9b04a4
```

### ุชุณุช JWT Token
- **GUID ุฏุฑ Token:** โ ููุฌูุฏ ุงุณุช
- **ูุซุงู:** `6f99b0b3-33e7-49da-8ce9-7b1b7450c2bb`

## ๐ฏ ุชุบุฑุงุช ููู

### ูุงูโูุง ุชุบุฑ ุงูุชู
1. **`apps/users/migrations/0002_user_guid.py`** - ูุงฺฏุฑุดู ุฌุฏุฏ
2. **`MIGRATION_FIX.md`** - ูุณุชูุฏุงุช ุญู ูุดฺฉู

### ูุงูโูุง ูููุช (ุญุฐู ุดุฏู)
- `check_users.py` - ุงุณฺฉุฑูพุช ุจุฑุฑุณ ฺฉุงุฑุจุฑุงู
- `fix_guid_migration.py` - ุงุณฺฉุฑูพุช ุญู ูุดฺฉู
- `test_guid_fix.py` - ุงุณฺฉุฑูพุช ุชุณุช ุฌุงูุน
- `simple_test.py` - ุชุณุช ุณุงุฏู

## ๐ ูุญูู ุงุฌุฑุง

### ุจุฑุฑุณ ูุถุนุช
```bash
python manage.py showmigrations users
```

### ุชุณุช GUID
```python
from django.contrib.auth import get_user_model
User = get_user_model()
for user in User.objects.all():
    print(f"{user.username}: {user.guid}")
```

### ุชุณุช JWT Token
```python
from apps.users.jwt_serializers import CustomRefreshToken
import jwt

user = User.objects.first()
refresh = CustomRefreshToken.for_user(user)
access_token = refresh.access_token

decoded = jwt.decode(str(access_token), options={"verify_signature": False})
print(f"GUID in token: {decoded.get('guid')}")
```

## โ ูุดฺฉูุงุช ุญู ุดุฏู

1. **UNIQUE constraint failed** - ุญู ุดุฏ
2. **ฺฉุงุฑุจุฑุงู ุจุฏูู GUID** - ุญู ุดุฏ
3. **ูุงฺฏุฑุดู ูุงูููู** - ุญู ุดุฏ
4. **JWT Token ุจุฏูู GUID** - ุญู ุดุฏ

## ๐ ูุถุนุช ูุนู

- โ ุชูุงู ฺฉุงุฑุจุฑุงู GUID ุฏุงุฑูุฏ
- โ GUID ุฏุฑ JWT Token ููุฌูุฏ ุงุณุช
- โ GUID ุฏุฑ API responses ููุฌูุฏ ุงุณุช
- โ ูุงฺฏุฑุดูโูุง ุงุฌุฑุง ุดุฏูโุงูุฏ
- โ ุฏุชุงุจุณ ุณุงูู ุงุณุช

## ๐ฎ ุชูุตูโูุง

1. **ูพุดุชุจุงูโฺฏุฑ:** ูุจู ุงุฒ ูุฑ ูุงฺฏุฑุดู ููู
2. **ุชุณุช:** ููุดู ูุงฺฏุฑุดูโูุง ุฑุง ุฏุฑ ูุญุท ุชุณุช ุจุฑุฑุณ ฺฉูุฏ
3. **ูุณุชูุฏุณุงุฒ:** ุชุบุฑุงุช ููู ุฑุง ูุณุชูุฏ ฺฉูุฏ
4. **ูุธุงุฑุช:** ูุถุนุช ุฏุชุงุจุณ ุฑุง ูุฑุชุจ ุจุฑุฑุณ ฺฉูุฏ

---

**ฺฏุฒุงุฑุด ุชูู ุดุฏู ุชูุณุท:** AI Assistant  
**ูุถุนุช:** ุชฺฉูู ุดุฏู โ
